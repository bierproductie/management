\section{Implementation}
\subsection{The Physical Setup (The Brewery Machine)}

The machine can produce different kinds of beer depending on the recipe
used. The beer is produced in batches which have their own batch id. When 
producing a batch the recipe, quantity, speed and batch id can be configured by 
an external system. When a batch has been produced the quality inspection system 
measures the quality for future use. These values are accessible in the machines 
SCADA system. The SCADA system monitors and supervises both the machines PLC 
system and the internal sensors PLC system as well as the quality inspection 
system.

\myparagraph{Sensors}
To ensure the most optimal environment beer production the 
machine is equipped with three sensors that measure the environment while 
production is happening. This data is useful as it gives insight into the 
internal environment of the machine while producing products. Currently, it 
measures temperature, humidity and vibration. The machine itself is not able to 
collect these data and are collected by an external system.

\myparagraph{Quality Inspection System}
To make it possible to calculate an error function, the system is 
equipped with a sophisticated quality inspection system. This system is key to 
optimising the production by giving data about the different error functions of 
the configurations so that they can be configured otherwise to maximise 
production. Each produced product is inspected and if the quality is low enough
the product will fail. When a batch is finished the QIS will output the amount 
of failed and passed products. The result is then used to calculate the error
function.


\subsection{The Simulator}
The group is going to use the simulator software to test the software during the
development cycle.
It is important to note that the simulator is not a replacement of the machine
since there is only so much randomness and correctness you can get from a 
simulator. 
It is still very important to have the simulator, when making prototypes and 
performing multiple tests on it, so any regressions won't be pushed to 
the production system(the beer machine).


\subsection{The dashboard}%
\myworries{\textbf{ref to the api \ref{sub:the_api}} } \\
The user interact with the dashboard. Through the dashboard the user can see
what the machine is producing and information about the production. The user can
also interact with the dashboard, they can start and stop the machine. Start a
new batch etc.
The dashboard is implemented on web based 
technology, so you can get it to run on many machine without installing any 
software, apart from a modern browser that is running JavaScript.
The group want to do many of the things without sorting on a big library or 
framework. The dashboard is only using 2 separate library one for making graphs
and one for essay access too icon's from iconify. 
\\
\href{https://www.chartjs.org/}{Link to graph library}.
\\
\href{https://iconify.design/}{Link to iconify}.


\subsection{The api}
\label{sub:the_api}
ref to the database and opc-ua

\subsection{The database}
relational yayayada postgres


\subsection{The OPC-UA-Client}
The OPC-UA-client handles the data from the machine and sends it to the API. It 
is written in java and uses the milo library to create a client that connects to 
the machines OPC-UA-server. The OPC-UA-client is able to subscribe to 
information on the server and send it to the API that stores it in the database. 
The client is also necessary to control the machine while it collects data it is 
also the client that creates and runs batches it gets from the dashboard through 
the API. It also sends live data via subscriptions, this data gets sent to the 
API every time a change appears and the API sends it to the dashboard. The 
client creates 6 subscriptions when started, they monitor temperature, 
vibration, humidity, machine-state,  current defective products and current 
processed products. 

The data gets both sent to the API and stored in an object called 
Batch. The Batch class \myworries{ref to source code I guess} has properties 
corresponding to the values the API uses as well as logic to process the data. 
This logic includes OEE calculation and JSON exportation. When running a batch a 
Batch object is created by using the data the dashboard provides. It is then run 
by providing the Batch object to the BatchHandler class that then runs the Batch 
object. While the batch is being processed the subscriptions will add data to 
the object. When done the Batch Object will run through its logic and finally 
export itself as a JSON so it can be sent to the API. 
